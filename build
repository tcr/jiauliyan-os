cd bin

echo [Compiling]
nasm -f elf -o loader.o ../assets/loader.s
nasm -f elf -o start.o ../src/start.s
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o kernel.o -c ../src/kernel.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o scrn.o -c ../src/scrn.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o gdt.o -c ../src/gdt.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o idt.o -c ../src/idt.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o isrs.o -c ../src/isrs.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o irq.o -c ../src/irq.c # -Werror
gcc -Wall -Wextra -m32 -fstrength-reduce -fomit-frame-pointer -finline-functions -nostdinc -fno-builtin -nostdlib -nostartfiles -nodefaultlibs -I../include -o timer.o -c ../src/timer.c # -Werror

echo
echo [Linking]
ld -melf_i386 -T ../assets/linker.ld -o kernel.bin loader.o gdt.o isrs.o irq.o timer.o start.o kernel.o scrn.o idt.o

echo
echo [Concat]
cat ../assets/stage1 ../assets/stage2 ../assets/pad kernel.bin > floppy.img

echo
echo Done.

cd ..
